{% extends './base.html' %}

{% block title %}Editar Usuario - AmicuSoft{% endblock %}

{% block mobile_menu %}
{% include 'includes/mobile_menu_admin.html' %}
{% endblock %}

{% block body %}
<div class="sidebar fade-in">
    <a href="#" class="sidebar-brand">AmicuSoft</a>
    
    <ul class="sidebar-nav">
        <li class="sidebar-nav-item">
            <a href="{{ url_for('panel') }}" class="sidebar-nav-link">
                <span>&#127968;</span>
                <span>Panel</span>
            </a>
        </li>
        <li class="sidebar-nav-item">
            <a href="{{ url_for('manage_user') }}" class="sidebar-nav-link active">
                <span>&#128101;</span>
                <span>Usuarios</span>
            </a>
        </li>
        <li class="sidebar-nav-item" style="margin-top: auto; padding-top: 24px; border-top: 1px solid var(--border-color);">
            <a href="{{ url_for('logout') }}" class="sidebar-nav-link">
                <span>&#128682;</span>
                <span>Cerrar Sesion</span>
            </a>
        </li>
    </ul>
</div>

<div class="main-content">
    <div class="header-bar slide-up">
        <div>
            <h1 class="page-title">Editar Usuario</h1>
            <p class="page-subtitle">ID: #{{ user.id }} - {{ user.fullname or user.nombre }}</p>
        </div>
    </div>
    
    {% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
        <div class="alert-custom slide-up mt-4">
            <span>&#8505;</span>
            <span>{{ message }}</span>
        </div>
        {% endfor %}
    {% endif %}
    {% endwith %}
    
    <div class="row mt-4 justify-content-center">
        <div class="col-md-8">
            <div class="card-custom slide-up">
                <h3 class="card-title-gradient mb-4">Informacion del Usuario</h3>
                
                <form method="post" action="{{ url_for('edit_user', user_id=user.id) }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-floating-custom">
                                <input type="text" id="username" name="username" value="{{ user.nombre or user.username }}" placeholder=" " required>
                                <label for="username">Nombre de Usuario</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating-custom">
                                <input type="text" id="fullname" name="fullname" value="{{ user.fullname }}" placeholder=" " required>
                                <label for="fullname">Nombre Completo</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-floating-custom">
                                <input type="email" id="email" name="email" value="{{ user.correo or user.email }}" placeholder=" " required>
                                <label for="email">Correo Electronico</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating-custom">
                                <select id="id_rol" name="id_rol" style="width: 100%; padding: 16px 20px; border: 2px solid var(--border-color); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary);">
                                    {% for r in roles %}
                                    {% if r.id_rol|int != 5 %}
                                    <option value="{{ r.id_rol }}" {% if r.id_rol|int == (user.id_rol|int) %}selected{% endif %}>
                                        {{ r.nombre_rol }}
                                    </option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex gap-3 mt-4 justify-content-end">
                        <a href="{{ url_for('manage_user') }}" class="btn-outline-custom">
                            Cancelar
                        </a>
                        <button type="submit" class="btn-primary-gradient">
                            Guardar Cambios
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
